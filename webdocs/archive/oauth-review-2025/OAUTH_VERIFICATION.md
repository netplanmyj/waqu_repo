# OAuth同意画面の審査準備

水質検査報告アプリでGmail API（機密スコープ）を使用するため、Googleの**OAuth同意画面の審査（OAuth Verification）**を受ける必要があります。

> **⚠️ 重要**: この審査が承認されるまで、アプリを一般公開できません。審査期間は通常**4-6週間**かかります。

---

## 📋 審査が必要な理由

このアプリは以下の**機密スコープ（Restricted Scope）**を使用しています：

- `https://www.googleapis.com/auth/gmail.send`
  - Gmail APIでメールを送信するために必須
  - Googleの厳格な審査が必要

---

## 🎯 審査に必要な準備項目

### 1. **プライバシーポリシーの公開**

#### 必須記載事項
```
✅ データ収集項目
  - 収集するユーザーデータ（メールアドレス、測定データなど）
  
✅ データの利用目的
  - Gmail API経由でのメール送信
  - 測定結果の記録・管理
  
✅ データの保存場所
  - 端末内のローカルストレージ
  - Firebase Functions（一時的な処理のみ）
  
✅ データの第三者提供
  - なし（ユーザー自身のGoogleアカウントから送信）
  
✅ データの保持期間
  - 履歴データ：ユーザーが削除するまで
  - アクセストークン：セッション終了まで
  
✅ ユーザーの権利
  - データの閲覧・削除権限
  - アカウント連携の解除方法
  
✅ 問い合わせ先
  - 開発者のメールアドレス
  - サポート連絡先
```

#### 公開場所
- [x] 独自ドメインのウェブサイト（推奨）✅

**公開済みURL**:
- **アプリホームページ**: https://netplan.co.jp/library/waqu_repo/
- **プライバシーポリシー**: https://netplan.co.jp/library/waqu_repo/privacy/

> ✅ **ステータス**: 公開完了（2025年10月16日）

---

### 2. **デモ動画の作成**

#### 📹 動画仕様
- **形式**: YouTube動画（限定公開可）
- **長さ**: 1-3分程度
- **解像度**: 720p以上推奨
- **言語**: 日本語（字幕・ナレーションなし可）

#### 🎬 動画の構成案

##### **シーン1: サインイン（15秒）**
```
タイトル表示: 「1. Googleアカウントでサインイン」

操作手順:
1. アプリ起動
2. 「Googleでサインイン」ボタンをタップ
3. Googleアカウント選択画面
4. OAuth同意画面で権限を確認
5. 「許可」をタップ
6. ホーム画面に遷移

強調ポイント:
- Gmail送信スコープの許可画面を明確に表示
- ユーザーが権限内容を確認できることを示す
```

##### **シーン2: 設定画面（20秒）**
```
タイトル表示: 「2. メール送信先の設定」

操作手順:
1. 設定アイコンをタップ
2. 送信先メールアドレスを入力
3. 地点番号を設定（例: 01）
4. デバッグモードの説明（オン/オフ切替）
5. テスト送信先の設定
6. 「保存」をタップ

強調ポイント:
- ユーザーが送信先を自由に設定できること
- テスト機能があることを示す
```

##### **シーン3: メイン画面（測定データ送信）（30秒）**
```
タイトル表示: 「3. 測定データを入力して送信」

操作手順:
1. メイン画面で月日を入力（例: 10/15）
2. 測定時刻を入力（例: 08:30）
3. 残留塩素濃度を入力（例: 0.5）
4. 「送信」ボタンをタップ
5. 送信中のローディング表示
6. 成功メッセージの表示
7. 「本日は送信済みです」の表示確認

強調ポイント:
- Gmail APIでメール送信する瞬間
- 送信完了の確認メッセージ
- 1日1回の制限機能
```

##### **シーン4: 履歴画面（15秒）**
```
タイトル表示: 「4. 送信履歴を確認」

操作手順:
1. 「履歴」タブに切り替え
2. 送信済みデータの一覧表示
3. 1件をタップして詳細表示
4. デバッグバッジの表示確認
5. 長押しで削除オプション表示

強調ポイント:
- データが端末内に保存されていること
- ユーザーが履歴を管理できること
```

##### **シーン5: 実際のメール確認（15秒）**
```
タイトル表示: 「5. 送信されたメールを確認」

操作手順:
1. Gmailアプリを開く
2. 送信済みメールボックスに移動
3. 送信したメールを表示
4. メール内容を確認（地点、月日、時刻、塩素濃度）

強調ポイント:
- ユーザーのGmailアカウントから送信されること
- メールフォーマットの確認
```

#### 📝 動画作成チェックリスト

- [ ] 各画面遷移を明確に表示
- [ ] 画面タイトルをテキストオーバーレイで追加
- [ ] Gmail送信スコープの許可画面を必ず含める
- [ ] 実際にメールが送信される様子を撮影
- [ ] 受信メールの内容を表示
- [ ] ユーザーデータの取り扱いが明確
- [ ] 音声なしでも理解できる構成

---

### 3. **アプリケーション情報**

#### アプリの説明
```
【アプリ名】
水質検査報告アプリ（Water Quality Reporter）

【用途】
水道施設の残留塩素濃度測定結果を、Gmail API経由でメール送信する業務効率化アプリです。

【Gmail APIの使用目的】
測定データ（月日、時刻、残留塩素濃度）を指定されたメールアドレスに送信するため。
ユーザー自身のGmailアカウントから、設定した宛先にメールを送信します。

【対象ユーザー】
- 水道施設管理者
- 水質検査担当者
- 自治体職員
- 水道工事業者
```

#### 技術詳細
```
【使用スコープ】
- https://www.googleapis.com/auth/gmail.send
  用途: 測定結果のメール送信

【認証フロー】
- OAuth 2.0
- Google Sign-In for Android/iOS

【データフロー】
1. ユーザーがアプリで測定データを入力
2. Firebase Functionsに送信リクエスト
3. Functions内でGmail APIを呼び出し
4. ユーザーのGmailアカウントからメール送信
5. 送信履歴を端末内に保存（ローカルストレージ）

【データ保存】
- ローカルストレージ: SharedPreferences（設定、履歴）
- サーバー保存: なし（Firebase Functionsは一時処理のみ）
```

---

### 4. **アプリのホームページ**

#### 必須要素
```
✅ アプリの概要説明
✅ 主な機能の紹介
✅ スクリーンショット
✅ プライバシーポリシーへのリンク
✅ サポート連絡先
✅ ダウンロードリンク（審査後）
```

**公開済みURL**: https://netplan.co.jp/library/waqu_repo/

> ✅ **ステータス**: 公開完了（2025年10月16日）

#### 掲載内容確認
- [x] アプリの概要説明
- [x] 主な機能の紹介（OAuth、メール送信、履歴管理）
- [x] プライバシーポリシーへのリンク
- [x] サポート連絡先
- [ ] スクリーンショット（推奨：追加を検討）
- [ ] ダウンロードリンク（OAuth審査承認後に追加）

---

## 📝 審査申請手順

### Step 1: Google Cloud Consoleで設定

1. **OAuth同意画面の設定**
   ```
   1. Google Cloud Console にアクセス
   2. プロジェクトを選択
   3. 「APIとサービス」→「OAuth同意画面」
   4. ユーザータイプ: 外部
   5. アプリ情報を入力
   ```

2. **アプリ情報の入力**
   ```
   - アプリ名: 水質検査報告アプリ
   - ユーザーサポートメール: [開発者メール]
   - アプリロゴ: 512x512 PNG
   - アプリのホームページ: [公開URL]
   - プライバシーポリシーURL: [公開URL]
   - 利用規約URL: [公開URL]（オプション）
   ```

3. **スコープの追加**
   ```
   - スコープを追加
   - gmail.send を検索
   - 追加して保存
   ```

4. **テストユーザーの追加**
   ```
   - 開発・テスト用のGoogleアカウントを追加
   - 審査中もテストユーザーは利用可能
   ```

### Step 2: 審査申請

1. **「公開ステータス」を変更**
   ```
   1. OAuth同意画面で「本番環境に公開」をクリック
   2. 審査準備の確認
   3. 「確認のため送信」をクリック
   ```

2. **補足情報の提出**
   ```
   - YouTube動画のURL（限定公開可）
   - プライバシーポリシーURL
   - アプリホームページURL
   - 追加の説明（任意）
   ```

3. **審査状況の確認**
   ```
   - メール通知: 審査開始・完了時
   - Cloud Console: ステータス確認
   - 審査期間: 通常4-6週間
   ```

---

## ⚠️ よくある却下理由と対策

### 却下理由1: プライバシーポリシー不備
```
❌ 問題: データ取り扱いの説明が不十分
✅ 対策: 
  - 収集データの具体的な項目を明記
  - Gmail APIでの送信フローを詳細に説明
  - データ保存期間を明確化
```

### 却下理由2: デモ動画が不明瞭
```
❌ 問題: Gmail APIの使用目的が不明確
✅ 対策:
  - OAuth同意画面を必ず撮影
  - メール送信の瞬間を明確に表示
  - 実際の送信メールを確認
```

### 却下理由3: スコープの正当性不足
```
❌ 問題: なぜgmail.sendが必要か説明不足
✅ 対策:
  - 業務用途を明確に説明
  - 代替手段がないことを示す
  - ユーザーメリットを強調
```

### 却下理由4: ホームページ不備
```
❌ 問題: アプリ情報が不十分
✅ 対策:
  - 機能説明を詳細化
  - スクリーンショットを追加
  - サポート体制を明示
```

---

## ✅ 審査承認後の対応

### 1. **一般公開の有効化**
```
- OAuth同意画面のステータスが「本番環境」に変更
- 100ユーザー制限が解除
- すべてのGoogleアカウントで利用可能
```

### 2. **Play Storeでの公開準備**
```
次のステップ: PLAYSTORE.md を参照
- アプリアイコン作成
- スクリーンショット撮影
- APK/AABビルド
- ストア審査申請
```

### 3. **モニタリング**
```
- Cloud Console でAPI使用状況を監視
- クォータ制限を確認
- エラーログをチェック
```

---

## 📅 スケジュール（推奨）

### Phase 1: 準備（1-2週間）
- [ ] プライバシーポリシー作成・公開
- [ ] アプリホームページ作成・公開
- [ ] デモ動画撮影・編集・アップロード
- [ ] OAuth同意画面の情報入力

### Phase 2: 審査申請（1日）
- [ ] 最終チェック
- [ ] 審査申請
- [ ] 確認メールの受信

### Phase 3: 審査待ち（4-6週間）
- [ ] 審査状況の定期確認
- [ ] 追加質問への対応準備
- [ ] Play Store準備の開始（並行作業可）

### Phase 4: 承認後（1週間）
- [ ] 承認通知の確認
- [ ] 本番環境での動作テスト
- [ ] Play Store公開準備の完了

---

## 🛠️ 必要なツール・サービス

### ホスティング
- [ ] **GitHub Pages**（無料、プライバシーポリシー用）
- [ ] **Firebase Hosting**（無料枠あり）
- [ ] 独自ドメイン（オプション、信頼性向上）

### 動画制作
- [ ] **画面録画ツール**
  - Android: AZ Screen Recorder
  - Emulator: Android Studio録画機能
- [ ] **動画編集ソフト**
  - DaVinci Resolve（無料）
  - iMovie（Mac）
  - Shotcut（無料）
- [ ] **YouTube**（動画公開用）

### 文書作成
- [ ] **Markdown エディタ**（プライバシーポリシー）
- [ ] **静的サイトジェネレーター**（Jekyll、Hugo等）

---

## 📞 サポート・リソース

### 公式ドキュメント
- [OAuth API Verification FAQ](https://support.google.com/cloud/answer/9110914)
- [OAuth同意画面の構成](https://support.google.com/cloud/answer/10311615)
- [Gmail API 使用ポリシー](https://developers.google.com/gmail/api/auth/about-auth)

### コミュニティ
- Stack Overflow: `google-oauth`タグ
- Google Cloud Community

---

## 🎯 次のアクション

1. **プライバシーポリシー作成**
   - テンプレートを使用
   - Gmail API使用を明記
   - 公開URLを確保

2. **デモ動画撮影**
   - シナリオ確認
   - 画面録画
   - 編集・アップロード

3. **アプリホームページ作成**
   - GitHub Pagesで公開
   - 必須情報を掲載

4. **審査申請**
   - OAuth同意画面の設定完了
   - 審査リクエスト送信

---

**⏰ 重要**: OAuth審査の承認を得てから、Play Storeへの公開準備を本格化させます。
