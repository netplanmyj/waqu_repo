# OAuth審査用テストユーザー設定ガイド

Firebase FunctionsとOAuth同意画面でテストユーザーを設定する方法です。

---

## 🎯 テストユーザーとは

### 目的

```
OAuth同意画面が「テスト」モードの間、
以下のユーザーのみがアプリを使用できます：

✅ テストユーザーとして登録されたGoogleアカウント
❌ その他の一般ユーザー（エラーになる）

審査承認後は制限が解除され、全ユーザーが使用可能になります。
```

### いつ必要か

```
必要なケース:
✅ OAuth審査申請前のテスト
✅ デモ動画撮影
✅ 開発者以外がテストする場合
✅ 審査期間中の動作確認

不要なケース:
❌ 開発者本人のみが使用
❌ 審査承認後（一般公開後）
```

---

## 📋 テストユーザー追加手順

### ステップ1: Google Cloud Consoleにアクセス

1. **Google Cloud Console を開く**
   ```
   https://console.cloud.google.com/
   ```

2. **プロジェクトを選択**
   ```
   プロジェクト: waqu-repo-2025
   ```

3. **OAuth同意画面に移動**
   ```
   左メニュー → APIとサービス → OAuth同意画面
   
   または直接アクセス:
   https://console.cloud.google.com/apis/credentials/consent
   ```

---

### ステップ2: テストユーザーを追加

#### 方法1: OAuth同意画面から追加

```
1. 「OAuth同意画面」タブを開く

2. 下にスクロールして「テストユーザー」セクションを見つける

3. 「+ ADD USERS」ボタンをクリック

4. メールアドレスを入力
   例:
   - waqu.demo@gmail.com
   - your.test.account@gmail.com
   - colleague@company.com

5. 複数追加する場合は改行で区切る:
   waqu.demo@gmail.com
   developer@company.com
   tester@company.com

6. 「SAVE」をクリック
```

#### 方法2: 編集画面から追加

```
1. OAuth同意画面で「EDIT APP」をクリック

2. 「Test users」ステップまで進む

3. 「+ ADD USERS」をクリック

4. メールアドレスを入力

5. 「SAVE」をクリック

6. 「SAVE AND CONTINUE」で次へ

7. 最後に「BACK TO DASHBOARD」
```

---

### ステップ3: 追加されたユーザーの確認

```
OAuth同意画面のダッシュボードで確認:

【テストユーザー】
✅ waqu.demo@gmail.com
✅ developer@company.com
✅ tester@company.com

表示されていればOK
```

---

## 🎬 デモ動画撮影用のテストユーザー

### 推奨設定

```
以下のアカウントをテストユーザーに追加:

1. デモ撮影用アカウント
   waqu.demo@gmail.com
   
   用途: デモ動画の撮影

2. 開発者アカウント
   your-email@gmail.com
   
   用途: 開発・テスト

3. 予備アカウント（任意）
   waqu.test@gmail.com
   
   用途: 再撮影が必要な場合
```

### 追加手順（具体例）

```
1. Google Cloud Console を開く
   https://console.cloud.google.com/

2. プロジェクト「waqu-repo-2025」を選択

3. 左メニュー → APIとサービス → OAuth同意画面

4. 「+ ADD USERS」をクリック

5. 以下を入力:
   waqu.demo@gmail.com
   
6. 「SAVE」をクリック

7. 確認: テストユーザー一覧に表示される
```

---

## 🔐 テストユーザーの権限

### できること

```
✅ アプリにサインイン可能
✅ OAuth同意画面で権限を許可可能
✅ Gmail API（gmail.send）を使用可能
✅ 全機能を使用可能
```

### できないこと（制限なし）

```
テストユーザーとして登録されていれば、
アプリのすべての機能を制限なく使用できます。

一般ユーザーとの違いは、
OAuth同意画面で「このアプリは審査中です」という
警告が表示されないことです。
```

---

## 📝 テストユーザー管理

### 追加できるユーザー数

```
制限: 最大100ユーザー

推奨:
- 開発チームメンバー: 3-5名
- テスター: 2-3名
- デモ用アカウント: 1-2名

合計: 5-10名程度で十分
```

### テストユーザーの削除

```
1. OAuth同意画面を開く

2. テストユーザーセクション

3. 削除したいユーザーの右側の「×」をクリック

4. 「SAVE」をクリック
```

### テストユーザーの変更

```
いつでも追加・削除可能:
✅ 審査申請前
✅ 審査期間中
✅ 審査承認後（テストモードに戻した場合）
```

---

## 🎯 デモ動画撮影での使用

### 撮影前の確認

```
□ デモ用アカウントを作成済み
  - メールアドレス: waqu.demo@gmail.com

□ テストユーザーに追加済み
  - Google Cloud Console で確認

□ アプリでサインインテスト
  - OAuth同意画面が表示される
  - 「許可」をタップできる
  - ホーム画面に遷移する

□ Gmail API動作確認
  - メール送信が成功する
  - 送信済みフォルダに表示される
```

### サインイン時の表示

#### テストユーザーの場合

```
OAuth同意画面:
┌─────────────────────────────┐
│ Water Quality Reporter      │
│                             │
│ このアプリは審査中です        │
│ （テストユーザーのみ使用可能）│
│                             │
│ このアプリは以下の権限を     │
│ 要求しています：             │
│ ✓ Gmailからメールを送信     │
│                             │
│ [許可]  [キャンセル]         │
└─────────────────────────────┘
```

#### 一般ユーザーの場合（テストユーザーでない）

```
エラー画面:
┌─────────────────────────────┐
│ アクセスがブロックされました  │
│                             │
│ このアプリはGoogleで        │
│ 審査されていません。         │
│                             │
│ 開発者に連絡してください。   │
│                             │
│ [戻る]                      │
└─────────────────────────────┘
```

---

## 🆘 トラブルシューティング

### 問題1: テストユーザーを追加できない

```
原因: OAuth同意画面が未設定
解決:
1. OAuth同意画面で「EDIT APP」
2. 必須項目をすべて入力
3. 「SAVE AND CONTINUE」で完了
4. その後、テストユーザー追加可能
```

### 問題2: テストユーザーでもサインインできない

```
原因1: メールアドレスのタイプミス
解決: 
- 正確なメールアドレスを確認
- @gmail.com を忘れずに

原因2: OAuth同意画面の公開ステータス
解決:
- 公開ステータス: 「テスト」になっているか確認
- 「本番環境」の場合はテストユーザー不要

原因3: アプリのOAuth設定
解決:
- google-services.json が正しいか確認
- Firebase Console でOAuth設定確認
```

### 問題3: OAuth同意画面に警告が表示される

```
テストユーザーの場合:
「このアプリは審査中です」
→ 正常です。撮影時はこのまま進めてOK

一般ユーザーの場合:
「アクセスがブロックされました」
→ テストユーザーに追加してください
```

---

## 📊 OAuth審査とテストユーザーの関係

### 審査前（テストモード）

```
公開ステータス: テスト

使用可能ユーザー:
✅ テストユーザーのみ
❌ 一般ユーザーは不可

制限:
- 最大100ユーザー
- 手動で追加が必要
```

### 審査中（テストモード継続）

```
公開ステータス: 審査中（Pending verification）

使用可能ユーザー:
✅ テストユーザーのみ
❌ 一般ユーザーは不可

注意:
- 審査期間中もテストユーザーは追加・削除可能
- 開発・テストを継続できる
```

### 審査承認後（本番環境）

```
公開ステータス: 本番環境（Published）

使用可能ユーザー:
✅ すべてのGoogleアカウントユーザー
✅ テストユーザー設定は不要

制限:
- なし
- 誰でもサインイン可能
```

---

## 💡 ベストプラクティス

### デモ動画撮影用

```
最小構成:
1. デモ用アカウント: waqu.demo@gmail.com
   → デモ動画撮影専用

これだけでOK
```

### 開発チーム用

```
推奨構成:
1. 開発者1: developer1@company.com
2. 開発者2: developer2@company.com
3. テスター: tester@company.com
4. デモ用: waqu.demo@gmail.com

合計: 4ユーザー
```

### 注意点

```
❌ 避けるべきこと:
- 大量のテストユーザー追加（管理が大変）
- 外部の知人を無計画に追加（セキュリティリスク）

✅ 推奨:
- 必要最小限のユーザーのみ追加
- 用途が終わったら削除
- 定期的に見直し
```

---

## ✅ デモ動画撮影用チェックリスト

### 撮影前の準備

```
□ デモ用Googleアカウント作成
  - メールアドレス: waqu.demo@gmail.com
  - アカウント名: Demo User
  - パスワード: 強力なものを設定

□ Google Cloud Console でテストユーザー追加
  - プロジェクト: waqu-repo-2025
  - OAuth同意画面 → テストユーザー
  - waqu.demo@gmail.com を追加

□ アプリでサインインテスト
  - waqu.demo@gmail.com でサインイン
  - OAuth同意画面が表示される
  - 「許可」をタップ
  - ホーム画面に遷移

□ メール送信テスト
  - 測定データを入力
  - 送信ボタンをタップ
  - 送信成功メッセージ表示
  - Gmail送信済みフォルダで確認

□ 撮影準備完了
  - テストユーザー設定OK
  - アプリ動作確認OK
  - 撮影環境準備OK
```

---

## 🚀 次のステップ

### 今すぐ実施

```
1. デモ用Googleアカウント作成（未作成の場合）
   https://accounts.google.com/signup
   
   入力内容:
   - 名前: Demo User
   - メールアドレス: waqu.demo@gmail.com
   - パスワード: [強力なパスワード]

2. Google Cloud Console でテストユーザー追加
   https://console.cloud.google.com/apis/credentials/consent?project=waqu-repo-2025
   
   手順:
   - 「+ ADD USERS」をクリック
   - waqu.demo@gmail.com を入力
   - 「SAVE」をクリック

3. 動作確認
   - アプリ起動
   - waqu.demo@gmail.com でサインイン
   - メール送信テスト

所要時間: 10-15分
```

---

## 📝 まとめ

### テストユーザー追加の重要性

```
✅ デモ動画撮影に必須
  - デモ用アカウントでサインインできる
  - OAuth同意画面が正しく表示される

✅ 開発・テストに便利
  - 複数の開発者が使用可能
  - 審査期間中も開発継続可能

✅ 簡単に設定可能
  - 5分で追加完了
  - いつでも追加・削除可能
```

### 手順まとめ

```
1. Google Cloud Console を開く
   https://console.cloud.google.com/

2. プロジェクト「waqu-repo-2025」を選択

3. OAuth同意画面 → テストユーザー

4. 「+ ADD USERS」をクリック

5. waqu.demo@gmail.com を入力

6. 「SAVE」をクリック

7. 完了！
```

---

**これでデモ動画撮影の準備が整います！** 🎬✨
