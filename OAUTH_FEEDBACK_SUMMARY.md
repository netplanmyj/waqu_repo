# OAuth審査フィードバック対応サマリー

**対応日**: 2025年10月17日  
**フィードバック受領日**: 2025年10月16日

---

## 📋 受領したフィードバック

### 1. ❌ 最小スコープのリクエスト要件
```
提供された理由では、リクエストした OAuth スコープが必要な理由が
十分に説明されていません。
```

### 2. ❌ ホームページの要件
```
アプリが ホームページの要件 を満たしていません。次の問題を解決してください。
ホームページでアプリの目的が説明されていません。
```

### 3. ⚠️ アプリ名称の不統一（根本原因）
- waqu-repo-2025（Firebaseプロジェクト名）
- 水質報告アプリ（旧ドキュメント）
- waqu repo（スペース付き）

---

## ✅ 実施した対応

### 1. アプリ名の統一

**正式名称を定義**:
```
日本語: 水質検査報告アプリ waqu_repo
英語: Water Quality Reporter
パッケージ名: waqu_repo
```

**更新したファイル**:
- ✅ `docs/index.md` - ホームページ
- ✅ `docs/privacy-policy.md` - プライバシーポリシー
- ✅ `pubspec.yaml` - すでに正しい（確認済み）

### 2. ホームページの大幅改善（docs/index.md）

#### 追加したセクション:

##### 📝 「アプリの目的」（新規）
```markdown
水質検査報告アプリ waqu_repo は、日本の水道施設で働く作業員が、
水道法に基づく残留塩素濃度の測定結果を施設管理者にメール報告する
ための業務用Androidアプリケーションです。

解決する課題:
- 手動でのメール作成が手間で時間がかかる
- 報告フォーマットが統一されず、ミスが発生しやすい
- 外出先からの報告が困難
- 送信履歴の管理ができない

なぜGmail APIを使用するのか:
1. 責任追跡と監査証跡
2. セキュリティ（OAuth 2.0認証）
3. 送信確認（Gmailの送信済みフォルダ）
4. 法令遵守（水道法に基づく報告義務）
```

##### 🔐 「使用する権限とその理由」（新規）
```markdown
Gmail API (gmail.send)

使用目的:
- 作業員のGmailアカウントから施設管理者へ測定報告メールを送信

使用しないスコープ:
- ❌ メール読み取り (gmail.readonly)
- ❌ メール変更 (gmail.modify)
- ❌ 連絡先アクセス
- ❌ その他のGoogleサービス

データフロー:
1. 作業員が測定値を入力
2. アプリが測定結果をフォーマット
3. Gmail API (gmail.send) で作業員のGmailから送信
4. 施設管理者がメールを受信
5. 送信履歴を端末内に保存
```

##### 🛠️ 「技術仕様」（新規）
```markdown
- プラットフォーム: Android
- 開発言語: Dart / Flutter
- 認証: Google OAuth 2.0
- 使用API: Gmail API (gmail.send スコープのみ)
- データ保存: 端末内ローカルストレージ
- バックエンド: Firebase Functions (メール中継のみ)
```

##### 📊 「主な機能」（拡充）
各機能の詳細説明を追加：
- 簡単入力（測定値、日時、地点番号）
- Gmail API経由でメール送信（OAuth 2.0認証）
- 送信履歴管理（端末内のみ）
- セキュリティとプライバシー（詳細説明）

### 3. スコープ使用理由の改善版作成

**新規ドキュメント**: `OAUTH_SCOPE_JUSTIFICATION.md`

内容:
- 業務要件の詳細説明
- なぜGmail APIが必要か（代替手段がない理由）
- 最小権限の原則（gmail.sendのみ）
- 具体的な使用シナリオ（5ステップ）
- データプライバシー保護
- 英語版・日本語版の両方を用意

### 4. ホームページ要件対応ガイド作成

**新規ドキュメント**: `OAUTH_HOMEPAGE_REQUIREMENTS.md`

内容:
- 問題の原因分析
- 実施した対応の詳細
- Google Cloud Console での更新手順
- 再申請の手順
- ホームページ要件チェックリスト
- 審査を通すためのポイント

### 5. チェックリスト更新

**更新ファイル**: `OAUTH_REVIEW_CHECKLIST.md`

追加内容:
- 審査フィードバックセクション
- 再申請準備チェックリスト
- ホームページ更新・デプロイ手順
- Google Cloud Console 更新項目

---

## 📋 次のアクション（優先順位順）

### 1️⃣ ホームページのデプロイ（今日中）

```bash
# Astroサイトにデプロイ
# 更新した docs/index.md と docs/privacy-policy.md を反映

デプロイ後の確認:
✅ https://netplan.co.jp/library/waqu_repo/ にアクセス
✅ アプリ名が「水質検査報告アプリ waqu_repo」になっている
✅ 「アプリの目的」セクションが表示される
✅ 「なぜGmail APIを使用するのか」が表示される
✅ データフローが表示される
```

### 2️⃣ Google Cloud Console の更新（今日中）

```
1. https://console.cloud.google.com/ にアクセス
2. プロジェクト「waqu-repo-2025」を選択
3. 「APIとサービス」→「OAuth同意画面」
4. 「編集」をクリック

更新項目:
□ アプリ名: 水質検査報告アプリ waqu_repo
           または Water Quality Reporter

□ アプリの説明（英語）:
  OAUTH_HOMEPAGE_REQUIREMENTS.md の説明文を貼り付け

□ スコープ使用理由:
  OAUTH_SCOPE_JUSTIFICATION.md の改善版テキストを貼り付け

5. 「保存」をクリック
```

### 3️⃣ デモ動画の作成（最優先）

```
□ テストユーザー追加（waqu.demo@gmail.com）
□ デモ動画撮影（5シーン、1分30秒）
□ YouTube公開（限定公開）
□ URL取得
```

### 4️⃣ 再申請（すべて完了後）

```
□ ホームページデプロイ完了確認
□ Google Cloud Console 更新完了確認
□ デモ動画公開完了確認
□ 「確認のため送信」ボタンをクリック
□ 追加フォームに記入
□ 送信
```

---

## 📊 対応前後の比較

### ホームページの改善

| 項目 | 対応前 | 対応後 |
|-----|--------|--------|
| アプリ名 | 水質報告アプリ | 水質検査報告アプリ waqu_repo ✅ |
| アプリの目的 | なし ❌ | 詳細説明あり ✅ |
| Gmail API使用理由 | なし ❌ | 4つの理由を明記 ✅ |
| データフロー | なし ❌ | 5ステップで図示 ✅ |
| 使用スコープ | 簡単な説明 | 詳細説明+不使用スコープ明記 ✅ |
| 技術仕様 | なし ❌ | 6項目を明記 ✅ |

### 審査要件への適合

| 要件 | 対応前 | 対応後 |
|-----|--------|--------|
| アプリの目的説明 | ❌ 不十分 | ✅ 明確に説明 |
| スコープ使用理由 | ❌ 不十分 | ✅ 詳細に説明 |
| アプリ名統一 | ❌ バラバラ | ✅ 統一完了 |
| 代替手段の検討 | ❌ なし | ✅ SMTP等と比較 |
| 最小権限の原則 | 🔶 記載あり | ✅ 強調+不使用スコープ明記 |
| データプライバシー | 🔶 簡単な説明 | ✅ 詳細説明 |

---

## 📁 作成・更新したファイル一覧

### 新規作成
1. `OAUTH_SCOPE_JUSTIFICATION.md` - スコープ使用理由の改善版
2. `OAUTH_HOMEPAGE_REQUIREMENTS.md` - ホームページ要件対応ガイド
3. `OAUTH_FEEDBACK_SUMMARY.md` - このファイル

### 更新
1. `docs/index.md` - ホームページ（大幅改善）
2. `docs/privacy-policy.md` - アプリ名統一、更新日追加
3. `OAUTH_REVIEW_CHECKLIST.md` - フィードバック対応セクション追加

### 確認済み（変更不要）
1. `pubspec.yaml` - すでに正しい名称

---

## ⏱️ 想定される再審査期間

```
再申請後:
- Day 1-3: 自動チェック（形式要件）
- Day 4-7: 初回レビュー開始
- Week 2-4: 詳細審査
- Week 4-6: 最終審査
- Week 6: 承認 🎉 または追加質問
```

---

## 💡 重要なポイント

### 今回の改善のキーポイント

1. **具体的な業務目的**: 水道法に基づく法的要件として説明
2. **Gmail API の必然性**: 責任追跡、監査証跡の観点から説明
3. **最小権限の明示**: gmail.send のみ、他は不使用
4. **データプライバシー**: 端末内のみ、サーバー保存なし
5. **アプリ名統一**: 一貫性のある名称使用

### 審査を通すための追加アドバイス

✅ **デモ動画が最重要**: OAuth同意画面を明確に表示  
✅ **英語での説明推奨**: 審査担当者の多くは英語圏  
✅ **具体例を示す**: 実際の業務フローを説明  
✅ **代替手段を検討**: なぜGmail APIでなければならないか  
✅ **一貫性**: すべてのドキュメントでアプリ名を統一  

---

**次のステップ**: ホームページをデプロイして、Google Cloud Console を更新してください。

関連ドキュメント:
- `OAUTH_HOMEPAGE_REQUIREMENTS.md` - 詳細な対応手順
- `OAUTH_SCOPE_JUSTIFICATION.md` - スコープ理由の改善版テキスト
- `OAUTH_REVIEW_CHECKLIST.md` - 進捗チェックリスト
